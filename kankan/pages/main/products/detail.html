<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>Hello MUI</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../../../css/mui.min.css">
		<link rel="stylesheet" type="text/css" href="../../../css/icons-extra.css" />
		<link rel="stylesheet" href="../../../css/kankan_home.css" />
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">商品名称</h1>
			<a class="mui-icon  mui-icon-reload mui-icon-right-nav mui-pull-right"></a>
		</header>
		<div class="mui-content">
			<div id="slider" class="mui-slider" >
			  <div class="mui-slider-group mui-slider-loop">
			    <!-- 额外增加的一个节点(循环轮播：第一个节点是最后一张轮播) -->
			    <div class="mui-slider-item mui-slider-item-duplicate firstimage">
			        <img src="">
			    </div>
			    <!-- 第一张 -->
			    <!--<div class="mui-slider-item">
			        <img src="http://placehold.it/400x300"> 
			    </div>-->
			    <!-- 额外增加的一个节点(循环轮播：最后一个节点是第一张轮播) -->
			    <div class="mui-slider-item mui-slider-item-duplicate lastimage">
			        <img src="">
			    </div>
			  </div>
			  <div class="mui-slider-indicator">
			    <div class="mui-indicator mui-active"></div>
			    <div class="mui-indicator"></div>
			    <div class="mui-indicator"></div>
			    <div class="mui-indicator"></div>
			  </div>
			</div>
			<ul class="mui-table-view">
				<li class="mui-table-view-cell">
					<p class="kankan_productname">Product Name Product Name Product Name Product Name Product Name </p>
					<div class="mui-pull-left kankan_zanbox">
						<div id="zanhou" style="display:none;" onclick="dianzan(this.id)" class="kankan_goods">
							<span class="mui-icon-extra mui-icon-extra-heart-filled ka_heartred"></span>
							<p class="kankan_goodsfonts lang" data-locale="det_goodconcel">取消</P>
						</div>
						<div id="zanqian" onclick="dianzan(this.id)" class="kankan_goods">
							<span class="mui-icon-extra mui-icon-extra-heart-filled ka_heartgrey"></span>
							<p class="kankan_goodsfonts lang" data-locale="det_goods">赞</P>
						</div>
					</div>
					<div class="mui-pull-right kankan_det_comment" onclick="location.href='pro_commentslist.html'">
						<span class="mui-icon mui-icon-chatboxes"></span>
						<p><span class="lang" data-locale="det_comment">评论</span>&nbsp;&nbsp;
							<font color="#000000" size="3" id="commentsnum">0</font>
						</P>

					</div>

					<div class="kankan_det_goodsnum" id="zanshu">0</div>
				</li>
				<li class="mui-table-view-cell kankan_det_description">
					<div class="mui-pull-left lang" data-locale="det_spdescription"></div>
				</li>
				<li class="mui-table-view-cell">
					<div class="kankan_det_information">Content Content Contents Content Contents Content Contents Content</div>
				</li>
			</ul>
			<!--share-->
			<ul class="mui-table-view">
				<li class="mui-table-view-cell kankan_det_description">
					<span class="lang" data-locale="det_spahare"></span>
					<img src="../../../images/weixin.png" width="30" height="30">
					<img src="../../../images/facebook.png" width="40" height="30">
					<img src="../../../images/line.png" width="30" height="30">
					<img src="../../../images/twitter.png" width="30" height="30">

				</li>
			</ul>
			<!--Producer information-->
			<div class="kankan_det_author">
				<ul class="mui-table-view">
					<li class="mui-table-view-cell kankan_det_description productlist">
						<a href="productslist.html">
							<div class="mui-pull-right">
								<span class="mui-icon-extra mui-icon-extra-find kankan_det_aulocation"></span>
								<!--<img src="./images/location.png" width="25" height="25" style="margin-left: -1.5em;">-->
								<p class="kankan_det_locationinfo"></p>
							</div>
							<div class="mui-pull-left">
								<img src="../../../images/logo.png" width="40" height="40" class="ka_touxiangimg"></div>
							<div class="ka_authorname"><b></b></div>
							<div>
								<img src="../../../images/china.png" width="20" height="20" class="lanch" style="display: none;">
								<img src="../../../images/jp.png" width="20" height="20" class="lanjp" style="display: none;">
								<img src="../../../images/hk.png" width="20" height="20" class="lanhk" style="display: none;">
								<img src="../../../images/us.png" width="20" height="20" class="lanen" style="display: none;">
							</div>
							<font color="#808080" size="2"><span class="lang" data-locale="det_coments">评价</span>:
								<font color="#007AFF" class="authcom"></font> <span class="lang" data-locale="det_producednum">出品数</span>:
								<font color="#007AFF" class="authcomdnum"></font>
							</font>

			</div>
			</a>
			</li>
			</ul>
		</div>
		<!--Produce goods of concern-->
		<h5 class="ka_h5backcolor lang" data-locale="det_concerneds">出品者关注商品</h5>
		
		
		<!--Recommended products-->
		<h5 class="ka_h5backcolor lang" data-locale="det_recommends">推荐商品</h5>
		<div class="mui-slider">
			<div class="mui-slider-group mui-slider-loop">
				<!--last-->
				<!-- 额外增加的一个节点(循环轮播：第一个节点是最后一个图文表格) -->
				<div class="mui-slider-item mui-slider-item-duplicate" id="lastrecommend">
					<ul class="mui-table-view mui-grid-view" id="lastremmondul">
						
					</ul>
				</div>
				<!-- 额外增加的一个节点(循环轮播：最后一个节点是第一个图文表格) -->
				<!--first-->
				<div class="mui-slider-item mui-slider-item-duplicate">
					<ul class="mui-table-view mui-grid-view" id="firstremmondul">
						<!--<li class="mui-table-view-cell mui-media mui-col-xs-3 detail">
							<a href="#">
								<img class="mui-media-object" src="../../../images/muwu.jpg">
				
							</a>
						</li>-->
					</ul>
				</div>
			</div>
		</div>

		<!--Commodity exchange, white send, point exchange information button-->
		<div style="margin: 1em 0;">
		<button type="button" class="mui-btn mui-btn-danger" id="switchp" style="display: none;">
			<span class="lang" data-locale="det_pointexch"><b>point(<span class="comdprice">10</span>)</b></span>
		</button>
			<button type="button" class="mui-btn mui-btn-danger" id="switchex" style="display: none;">
			<span class="lang" data-locale="det_exchange"><b>交换</b></span>
		</button>
			<button type="button" class="mui-btn mui-btn-danger" id="switchsend" style="display: none;">
			<span class="lang" data-locale="det_send"><b>白送</b></span>
		</button>
		</div>
		<div id="text">null</div>
		</div>
		<script src="../../../js/mui.min.js"></script>
		<script src="../../../js/jquery-3.2.0.min.js"></script>
		<!--<script src="../../../js/language.js"></script>-->
		<script src="../../../js/knockout-3.4.2.js"></script>
		<script src="../../../js/sha256.js"></script>
		<script src="../../../js/common.js"></script>
		<script type="text/javascript" charset="utf-8">
			mui.init({
				swipeBack: true //启用右滑关闭功能
			});
			//send param
			var ws = null;
			mui.plusReady(function() {
				ws = plus.webview.create("detail.html", "detail");
			});
			mui('.detail').on('tap', 'a', function(e) {
				var targetId = this.getAttribute("id");
				ws.evalJS('send(' + targetId + ')');
				ws.show();
			})
			// get id show product detail
			function send(param) {
				var proid = param;
				var params = {
					"tokencheck": "",
					"signcheck":Api.createSignInfo(),
					//"nickname": auth.userInfo.nickname,
					//"headimgurl": auth.userInfo.headimgurl,
					"commodity_id": "100001"
				};
				Repository.User.commoditydetail(params, {
					success: function(data) {
						//console.dir(data.result.data.commodity_imgs);
						if(data.result.status == 'OK') {
							console.log("成功");
							messageshow(data);
							
						} else {
							console.log("失败");
						}
					},
					error: function(xhr, type, errorThrown) {
						mui.alert('发生未知错误，请稍后重试。', 'Error', function() {});
					}
				});

			}
			//message show
			function messageshow(results) {
				var commodity = results.result.data;
				var comdbasic = commodity.commodity_basic;
				//var comdinfo=JSON.stringify(comdbasic[0]);
				//console.log(comdinfo);
				var comdname=comdbasic[0].comm_name;
				var comdmesage=comdbasic[0].comm_detail;
				$(".kankan_productname").html(comdname);//name
				$(".kankan_det_information").html(comdmesage);//message
				$(".mui-title").html(comdname);//title
				//lunbo
				var slider = mui("#slider");
				slider.slider({
					interval: 1000
				});
				var comdimgs=commodity.commodity_imgs[0];
				var imgsarr=comdimgs.split(',');
				for(i=0;i<imgsarr.length;i++){
					var la=imgsarr.length-1*1;
					$(".firstimage img").attr("src",imgsarr[0]);
					$(".lastimage img").attr("src",imgsarr[la]);
					var htmlimg='<div class="mui-slider-item">';
			        htmlimg+='<img src="'+imgsarr[i]+'">';
			        htmlimg+='</div>';
					//console.log(imgsarr[la]);
				}
				var goodcount=commodity.commodity_praise.praise_count;
				$("#zanshu").html(goodcount);
				var comentnum=commodity.commodity_levave_mess.leave_mess_count;
				$("#commentsnum").html(comentnum);//product comment count
				var uname=commodity.user_basic.user_name;
				var uimage=commodity.user_basic.user_photo;
				var ucomentnum=commodity.user_basic.user_comment_count;
				var uadress=commodity.user_basic.pref_detail;
				var ucomeditynum=commodity.user_basic.user_commodity_count;
				$(".ka_authorname b").html(uname);
				$(".ka_touxiangimg").attr("src","uimage");
				$(".authcom").html(ucomentnum);
				$(".authcomdnum").html(ucomeditynum);
				$(".kankan_det_locationinfo").html(uadress);
				var authlang=commodity.user_basic.talk_flag;
				if(authlang.indexOf("0")>0){
					$(".lanjp").show();
				}
				if(authlang.indexOf("1")>0){
					$(".lanch").show();
				}
				if(authlang.indexOf("2")>0){
					$(".lanen").show();
				}
				if(authlang.indexOf("3")>0){
					$(".lanhk").show();
				}
				//buy way
				var exchange=commodity.commodity_buy_way.exchange;
				var business=commodity.commodity_buy_way.business;
				var gratis=commodity.commodity_buy_way.gratis;
				var price=comdbasic[0].price;
				console.log("exchange:"+exchange+" business:"+business+" gratis:"+gratis+" price:"+price);
				if(exchange=="1"){
					$("#switchex").show();
				}
				if(business=="1"){
					$("#switchp").show();
					$(".comdprice").html(price);
				}
				if(gratis=="1"){
					$("#switchsend").show();
				}
				//recommend
				var recomendhtml='<div class="mui-slider-item">';
					recomendhtml+='<ul class="mui-table-view mui-grid-view">';
				var recomendsarrs=commodity.commodity_recommend;
				var recomdlenght=recomendsarrs.length;
				alert(recomdlenght);
				var recomendsobj={};
				var recomendaddhtml="";//add dom
				//var k=0;
				for(var j=0;j<recomdlenght;j++){
					var k=j+1*1;
					console.log("j:"+j+" k:"+k);
					var recomendsobj1=JSON.stringify(recomendsarrs[j]);
					recomendsobj=$.parseJSON(recomendsobj1); 
					//console.log(recomendsobj1);
					var recomdimg=recomendsobj.commodity_photo_url;
					var recomdid=recomendsobj.commodity_id;
					var advflag=recomendsobj.is_ad;
					console.log("recomdimg:"+recomdimg);
					recomendhtml+='<li class="mui-table-view-cell mui-media mui-col-xs-3 detail">';
					recomendhtml+='<a href="#" id="20">';
					recomendhtml+='<img class="mui-media-object" src="'+recomdimg+'">';	
					recomendhtml+='</a></li>';
					var vall=k%4;
					if(vall==0 || j==recomdlenght){
						recomendhtml+='</ul></div>';
					}	
					if(vall==0 && j < recomdlenght){
						recomendhtml+='<div class="mui-slider-item">';
						recomendhtml+='<ul class="mui-table-view mui-grid-view">';
					}
					$("lastrecommend").append(recomendhtml);
					recomendaddhtml+='<li class="mui-table-view-cell mui-media mui-col-xs-3 detail">';
					recomendaddhtml+='<a href="#" id="20">';
					recomendaddhtml+='<img class="mui-media-object" src="../../../images/muwu.jpg">';	
					recomendaddhtml+='</a></li>';
					if(j<4){
						$("#firstremmondul").html(recomendaddhtml);
					}
					if(j>recomdlenght-4){
						$("#lastremmondul").html(recomendaddhtml);
					}
					
				}
				//k=j+1;
			}
			//go back
			mui.back = function() {
				var self = plus.webview.currentWebview();
				self.hide();
			}
			//goods
			function dianzan(aid) {
				if(aid == "zanqian") {
					document.getElementById(aid).style.display = "none";
					document.getElementById("zanhou").style.display = "block";
					var goodbefor = document.getElementById("zanshu").innerHTML * 1;
					var gooafter = goodbefor + 1 * 1;
					document.getElementById("zanshu").innerHTML = gooafter;
					//mui("#zanshu").Style("color: #000000;margin-right: 0.1em;");
					//alert(gooafter);
				} else {
					//alert(aid);
					document.getElementById(aid).style.display = "none";
					document.getElementById("zanqian").style.display = "block";
					var goodbefor = document.getElementById("zanshu").innerHTML * 1;
					var gooafter = goodbefor - 1 * 1;
					document.getElementById("zanshu").innerHTML = gooafter;
					//alert(gooafter);
				}
			}
			mui(".productlist").on("tap", "a", function() {
				mui.openWindow({
					url: 'productslist.html',
					id: 'productslist'
				});
			});
		</script>
	</body>

</html>