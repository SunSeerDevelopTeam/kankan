<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>detail</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../../../css/mui.min.css">
		<link rel="stylesheet" type="text/css" href="../../../css/icons-extra.css" />
		<link rel="stylesheet" href="../../../css/iconmyfont.css" />
		<link rel="stylesheet" href="../../../css/kankan_home.css" />
		<link rel="stylesheet" href="../../../css/global.css" />
		<style>
			.Arrow {
				font-size: 4em;
				/*margin-top: 30%;*/
				color: #B6B6B6;
				filter: alpha(Opacity=80);
				-moz-opacity: 0.6;
				opacity: 0.6;
				position: absolute;
				top: 40%;
				left: 0;
				z-index: 2;
			}
			
			#slider {
				position: relative;
				z-index: 1;
			}
			
			.imgboxs {
				width: 100%;
				/*height: 320px;*/
				vertical-align: middle;
				display: inline-block;
				text-align: center;
				overflow: hidden;
				/*line-height: 320px;*/
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title"></h1>
		</header>
		<div  id="reloadpage" onclick="reloadpage()" style="display: none;"><font size="2" class="lang" data-locale="networkerrordetail"></font></div>
		<div id="loading" class="mui-content ka_userbox">
			<div class="spinner">
				<div class="double-bounce1"></div>
				<div class="double-bounce2"></div>
			</div>
		</div>
		<div class="mui-content" style="display: none;">
			<div id="slider" class="mui-slider">
				<div class="mui-slider-group lunboimgbox">
					<!-- last -->
					<!--<div class="mui-slider-item mui-slider-item-duplicate firstimage imgboxs" align="center" style="">
						<img src="" onerror="this.src='../../../images/nopic.jpg'">
					</div>-->
					<!-- first -->
					<!--<div class="mui-slider-item mui-slider-item-duplicate lastimage imgboxs" align="center" style="">
						<img src="" onerror="this.src='../../../images/nopic.jpg'">
					</div>-->
				</div>
				<div class="mui-slider-indicator">
				</div>
			</div>
			<ul class="mui-table-view">
				<li class="mui-table-view-cell">
					<p class="kankan_productname"></p>
					<div class="mui-pull-left kankan_zanbox">
						<div id="zanhou" style="display:none;" onclick="dianzan(this.id)" class="kankan_goods">
							<span class="mui-icon-extra mui-icon-extra-heart-filled ka_heartred"></span>
							<p class="kankan_goodsfonts lang" data-locale="det_goodconcel">
							</P>
						</div>
						<div id="zanqian" onclick="dianzan(this.id)" class="kankan_goods">
							<span class="mui-icon-extra mui-icon-extra-heart-filled ka_heartgrey"></span>
							<p class="kankan_goodsfonts lang" data-locale="det_goods">
							</P>
						</div>
					</div>
					<div class="mui-pull-right kankan_det_comment">
						<a href="pro_commentslist.html">
							<span class="mui-icon mui-icon-chatboxes"></span>
							<p><span class="lang" data-locale="det_comment"></span>&nbsp;&nbsp;
								<font color="#000000" size="3" id="commentsnum"></font>
							</P>
						</a>
						<span class="mui-icon iconfont icon-tousu mui-pull-right ka_warn" ></span>
						<input type="hidden" name="comodityid" id="comodityid" value="" />
					</div>

					<div class="kankan_det_goodsnum" id="zanshu"></div>
				</li>
				</ul>
				<h5 class="ka_h5backcolor lang" data-locale="det_spdescription"></h5>
				<span class="mui-icon iconfont icon-leaf open-window-title" style="color:red;margin-left: 4em;font-size: 22px;margin-top: -1em;"></span>
				<ul class="mui-table-view">
				<li class="mui-table-view-cell">
					<div class="kankan_det_information" style="word-break:break-word;"></div>
				</li>
			</ul>
			<h5 class="ka_h5backcolor lang comdinfo" data-locale="det_information"></h5>
			<ul class="mui-table-view comdinfo">
			        <li class="mui-table-view-cell">
			            <div class="mui-pull-left ka_sorttext lang" data-locale="commodity_sorts"></div>
			            <div class="mui-pull-left ka_sortvale" id="comd_sortvale"></div>
			        </li>
			       <li class="mui-table-view-cell">
			            <div class="mui-pull-left ka_sorttext lang" data-locale="commodity_stuates"></div>
			            <div class="mui-pull-left ka_sortvale" id="comd_stauteval"></div>
			        </li>
			    </ul>
	    	
			<!--share-->
			<ul class="mui-table-view">
				<li class="mui-table-view-cell kankan_det_description" id="share">
					<span class="lang sharetext" data-locale="det_spahare"></span>
					<div id="weixinimgbox">
						<img src="../../../images/weixin2.png">
					</div>
                </li>
			</ul>
			<!--Producer information-->
			<div class="kankan_det_author">
				<ul class="mui-table-view">
					<li class="mui-table-view-cell kankan_det_description productlist">
						<a href="productslist.html">
							<div class="mui-pull-right">
								<span class="mui-icon-extra mui-icon-extra-find kankan_det_aulocation"></span>
								<p class="kankan_det_locationinfo"></p>
							</div>
							<div class="mui-pull-left">
								<img src="" width="40" height="40" class="ka_touxiangimg"></div>
							<div class="ka_authorname"><b></b></div>
							<div class="ka_language">
								<img src="../../../images/china.png" width="20" height="20" class="lanch" style="display: none;">
								<img src="../../../images/jp.png" width="20" height="20" class="lanjp" style="display: none;">
								<img src="../../../images/hk.png" width="20" height="20" class="lanhk" style="display: none;">
								<img src="../../../images/us.png" width="20" height="20" class="lanen" style="display: none;">
							</div>
							<font color="#808080" size="2"><span class="lang" data-locale="det_coments"></span>:
								<font color="#007AFF" class="authcom"></font> <span class="lang" data-locale="det_producednum"></span>:
								<font color="#007AFF" class="authcomdnum"></font>
							</font>

			</div>
			</a>
			</li>
			</ul>
			<!--Produce goods of concern-->
			<h5 class="ka_h5backcolor lang concerned" data-locale=""></h5>
			<div class="mui-slider">
				<div class="mui-slider-group">
					<!--last-->
					<!--<div class="mui-slider-item mui-slider-item-duplicate" id="lastconcenered" style="display: none;">
						<ul class="mui-table-view mui-grid-view" id="lastconcerul">

						</ul>
					</div>-->
					<!--first-->
					<div class="mui-slider-item mui-slider-item-duplicate" id="firstconcerned">
						<ul class="mui-table-view mui-grid-view" id="firstconcerul">
						</ul>
					</div>
				</div>
			</div>
			<!--Recommended products-->
			<h5 class="ka_h5backcolor lang" data-locale="det_recommends"></h5>
			<div class="mui-slider" style="margin-bottom: 3em;">
				<div class="mui-slider-group">
					<!--last-->
					<!--<div class="mui-slider-item mui-slider-item-duplicate" id="lastrecommend">
						<ul class="mui-table-view mui-grid-view" id="lastremmondul">
						</ul>
					</div>-->
					<!--first-->
					<div class="mui-slider-item mui-slider-item-duplicate" id="firstrecommend">
						<ul class="mui-table-view mui-grid-view" id="firstremmondul">
						</ul>
					</div>
				</div>
			</div>

			<!--Commodity exchange, white send, point exchange information button-->
			<!--白送-->
			<div class="ka_buyway">
				<!--<a href="../../transaction/transaction2.html"></a><button type="button" class="mui-btn mui-btn-danger" id="switchp" style="display: none;"></a>
			<b><span class="lang" data-locale="det_pointexch"></span>(<span class="comdprice"></span>)</b>
		</button>-->
		        <a href="../../transaction/transaction2.html">
		        	<button type="button" class="mui-btn mui-btn-danger" id="switchex" style="display: none;">
		        </a>
		        <span class="lang" data-locale="det_exchange"><b></b></span>
		        <a href="../../transaction/transaction2.html">
				<button type="button" class="mui-btn mui-btn-danger" id="switchsend" style="display: none;"></a>
					<span class="lang" data-locale="det_send"><b></b></span>
				</button>
			</div>
			<!--正在交易中-->
			<div id="traslateing" class="lang" data-locale="stautestext"></div>
			<!--价格加购买-->
			<div id="bottom_price" class="gratis_goods">
		        <strong><div class="mui-pull-left">&yen;<span id="detail_commPrice"></span></div></strong>
		        <strong><div id="gotobuy" class="mui-pull-right lang" data-locale="det_buy" style="margin-right: 1em;"></div></strong>
		    </div>
			<input type="hidden" name="userid" id="userid" value="" />
			<input type="hidden" name="myid" id="myid" value="" />
			<input type="hidden" name="comm_num" id="comm_num" value="" />
			<!--Report-->
			<div id="report" class="mui-popover mui-popover-action mui-popover-bottom">
				<ul class="mui-table-view">
					<li class="mui-table-view-cell">
						<a id="see" href="#" style="color: #9C9C9C" disabled="true"></a>
					</li>
					<li class="mui-table-view-cell">
						<a id="reportGoods" onclick="complaint()" style="color: #007aff"></a>
					</li>
				</ul>
				<ul class="mui-table-view">
					<li class="mui-table-view-cell">
						<a href="#report" style="color: #007aff"></a>
					</li>
				</ul>
		    </div>
		    <!--pengyouquan-->
			<div id="friendChat" class="mui-popover mui-popover-action mui-popover-bottom">
				<ul class="mui-table-view">
					<li class="mui-table-view-cell">
						<a id="shareFriends" onclick="weixinchat('WXSceneSession')" style="color: #007aff"></a >
					</li>
					<li class="mui-table-view-cell">
						<a id="shareCircle" onclick="weixinchat('WXSceneTimeline')" style="color: #007aff"></a >
					</li>
				</ul>
				<ul class="mui-table-view">
					<li class="mui-table-view-cell">
						<a href="#friendChat" style="color: #007aff">cc</a >
					</li>
				</ul>
		    </div>
		</div>

		<script src="../../../js/mui.min.js"></script>
		<script src="../../../js/jquery-3.2.0.min.js"></script>
		<script src="../../../js/language.js"></script>
		<script src="../../../js/sha256.js"></script>
		<script src="../../../js/common.js"></script>
		<script type="text/javascript" src="../../../js/jquery.lazyload.min.js"></script>
		<script src="../../../js/windowOpen.js"></script>
		<script type="text/javascript" charset="utf-8">
			var commodity_id;
			var comm_exchange;
			var comm_business;
			var comm_gratis;
			var _w = parseInt($(window).width()); //获取浏览器的宽度
			mui.init({
				swipeBack: false,
				preloadPages: [
				//{
//						id: 'pro_commentslist.html',
//						url: 'pro_commentslist.html'
//					},
//					{
//						id: 'productslist.html',
//						url: 'productslist.html'
//					},
					{
						id: 'detail.html',
						url: 'detail.html'
					}
				],
				beforeback: function() {
					var view = plus.webview.currentWebview().opener();
			    	var cmid=$(".kankan_zanbox").attr("id");
					mui.fire(view,'praiseid',{
					    praiseid:cmid
					});
					self.location.reload();
				}
		    });
		    
		    
			window.addEventListener('cid', function(event) {
				var id = event.detail.id;
				var flagback=event.detail.flag;
				commodity_id = event.detail.id;
				mui.plusReady(function() {
					getinfo(id);
				});
				if(flagback=="concer"){
					$(".mui-content").hide();
					$("#loading").show();
//					mui(".mui-bar-nav").on("tap","a",function(){
//						var mainPage = plus.webview.getLaunchWebview();
//						mainPage.show();
//					});
				}
				
			});
			//*********************share start
            //onclick share
			var shares = {};
		    var sId;
		    var sImage;
		    var sName;
		    var sDetail;
			function clickshare(shareid,imgurl0,comdname,comdetail){
				sId = shareid;
				sImage = imgurl0;
				sName=comdname;
				sDetail=comdetail;
				mui.plusReady(function() {
					TextMessage.language = plus.os.language;
					plus.share.getServices(function(s) {
						if(s && s.length > 0) {
							for(var i = 0; i < s.length; i++) {
								var t = s[i];
								shares[t.id] = t;
							}
						}
					}, function() {
						console.log("share server fail");
					});
				});	
				document.getElementById("share").addEventListener('tap', function() {
					mui('#friendChat').popover('toggle');
				});
			}
		    
		    function shareMessage(share, ex) {
				var msg = {
					extra: {
						scene: ex
					}
				};
				var paramshareid = {
					"commodity_id": sId
				};
				Repository.Commodity.shareid(paramshareid, {
					ok: function(data) {
						console.log(data.data.commodity_id);
						var outid=data.data.commodity_id;
						shareout(outid)
						console.log("success");
					},
					ng: function(data) {
						console.log(data);
					}
				});
				function shareout(shareids){
					msg.href = Api.url.Commodity.shareurl+shareids;
					msg.title =sName;
					msg.content = sDetail;
					msg.thumbs = [sImage];
					share.send(msg, function() {
						var sharesuccesstext=TextMessage.share + "\"" + share.description + "\"" + TextMessage.success;
						console.log(TextMessage.share + "\"" + share.description + "\"" + TextMessage.success);
					}, function(e) {
						console.log(TextMessage.share + "\"" + share.description + "\"" + TextMessage.faile + e.code + " - " + e.message);
					});
				}
			}
				
			
			//share end***********/
			
            function weixinchat(flag) {
				var s_id = 'weixin';
				var share = shares[s_id];
				mui('#friendChat').popover('hide');
				if (share) {
					if (share.authenticated) {
						shareMessage(share, flag);
					} else {
						share.authorize(function() {
							shareMessage(share, flag);
						}, function(e) {
							console.log("error: " + e.code + " - " + e.message);
						});
					}
				} else {
					mui.toast("can not share server");
				}
			}
            $('.open-window-title').on('click',function(){
				setTitle = TextMessage.aboutDonate;
				setContents = '<div style="clear:both;padding-top: 1em;"><div style="text-align:left;text-indent:2em">'+TextMessage.donate1+'</div><div style="text-align:left;text-indent:2em;">'+TextMessage.donate2+'</div><div style="text-align:left;text-indent:2em;">'+TextMessage.donate3+'</div></div>';
				setButton = TextMessage.confirmBtnYes;
				$(this).openWindow(setTitle,setContents,[setButton]);
				$("body").bind("touchmove", function(e) {
					e.preventDefault();
				});
			});
			function reloadpage(){
				mui.back();
			}
			function emptyhtml() {
				$(".lunboimgbox").empty();
				$(".mui-slider-indicator").empty();
//				$(".firstimage img").attr("src", "");
//				$(".lastimage img").attr("src", "");
				$(".sliderimg").remove();
				//$("#lastremmondul").empty();
				$("#firstremmondul").empty();
				//$("#lastconcerul").empty();
				$("#firstconcerul").empty();
				$(".mui-title").empty();
				$("#userid").val("");
				$("#myid").val("");
				$("#comodityid").val("");
				$("#comm_num").val("");
				$(".kankan_productname").html(""); //name
				$(".kankan_det_information").html(""); //message
				$(".mui-title").html(""); //title
			}

			function getinfo(pid) {
				emptyhtml();
				var params = {
					"commodity_id": pid
				};
				Repository.Commodity.commodityDetail(params, {
					ok: function(data) {
						Log.d("success");
						comm_exchange = data.data.commodity_buy_way.exchange;
						comm_business = data.data.commodity_buy_way.business;
						comm_gratis = data.data.commodity_buy_way.business;
						messageshow(data);
						clickprocomment();
						clickwarn();
					},
					ng: function(data) {
						Log.d(data);
						if(data == "2001") {
							$("#loading").show();
							$(".mui-content").hide();
						}
					},
					error:function(errortypetext){
						$("#reloadpage").html(errortypetext);
						$(".mui-content").hide();
						$("#reloadpage").show();
					}
				});
			}
			function clickprocomment() {
				//commodity comments list
				var comdcommentpage = null;
				mui('.kankan_det_comment').on('tap', 'a', function(e) {
					var cid = $("#comodityid").val();
//					if(!comdcommentpage) {
//						comdcommentpage = plus.webview.getWebviewById('pro_commentslist.html');
//					}
//					mui.fire(comdcommentpage, 'comid', {
//						id: cid
//					});
					mui.openWindow({
						id: 'pro_commentslist',
						url:'pro_commentslist.html?comid='+cid,
						extras: {
								"comid": cid
							}
					});
				});
			}
			function clickwarn(){
				mui('.kankan_det_comment').on("tap",".ka_warn",function(e){
					if(mui.os.plus){
						mui('#report').popover('toggle');	
					}
				});
			}
			//complaint
			function complaint(){
				mui("#report").popover('hide');
				var comodid=$("#comodityid").val();
				var paramport={
					"commodity_id":comodid,
				}
				Repository.Commodity.reportCommodity(paramport, {
					ok: function(data) {
						Log.d("success");
//						mui.toast(TextMessage.comodityreport_success, {
//							duration: 'long',
//							type: 'div'
//						});
						mui.openWindow({
							id: 'complaint',
							url: "complaint.html",
							extras: {
						        "commodity_id": comodid
					        } 
						});
					},
					ng: function(data) {
						Log.d(data);
						if(data == "2001") {
							$("#loading").show();
							$(".mui-content").hide();
						}
						if(data == "1000") {
							mui.toast(TextMessage.test, {
								duration: 'long',
								type: 'div'
							});
							mui.openWindow({
								id: 'login',
								url: "../../login/login.html"
							});
						}
						if(data == "2004") {
							mui.toast(TextMessage.operation_error, {
								duration: 'long',
								type: 'div'
							});
						}
						if(data == "3022") {
							mui.toast(TextMessage.comodityrepot_repeat, {
								duration: 'long',
								type: 'div'
							});
						}
					},
					error:function(errortypetext){
						$("#reloadpage").html(errortypetext);
						$(".mui-content").hide();
						$("#reloadpage").show();
					}
				});
			}
			//message show
			function messageshow(results) {
				$(".mui-slider-indicator").empty();
				var screenheight=parseInt($(window).height())*0.5;
				var commodity = results.data;
				var comdbasic = commodity.commodity_basic;
				var userbasic = commodity.user_basic;
				var comdname = HTMLDecode(comdbasic[0].comm_name);
				var comdmesage = HTMLDecode(comdbasic[0].comm_detail).replace(/\n/g,"<br />");
				var comoditsort=comdbasic[0].catalog_detail+"&nbsp;<font color='#000000'>＞</font><br/>"+comdbasic[0].classify_detail;
				var comdistate=comdbasic[0].state;
				var donation_id=comdbasic[0].donation_id;
				var donation_amount=comdbasic[0].donation_amount;
				if(donation_id=="" || donation_amount<=0){
					$(".icon-leaf").hide();
				}
				if(comdistate=="0"){
					var comdistateval=TextMessage.prostaute0;
				}else if(comdistate=="1"){
					var comdistateval=TextMessage.prostaute1;
				}else if(comdistate=="2"){
					var comdistateval=TextMessage.prostaute2;
				}else{
					var comdistateval=TextMessage.prostaute3;
				}
				var comdityid = comdbasic[0].commodity_id;
				var traslatestautes=comdbasic[0].status;
				var buy_sell_flag = comdbasic[0].buy_sell_flag;
				var price = comdbasic[0].price;
				var myid=results.myid;
				var tradeablenum = userbasic.user_comm_tradable_count;
				$("#comd_stauteval").html(comdistateval);//state
				$("#comd_sortvale").html(comoditsort);//sort
				$("#myid").val(myid);
				$("#comodityid").val(comdityid);
				$("#comm_num").val(tradeablenum);
				$(".kankan_productname").html(comdname); //name
				$(".kankan_det_information").html(comdmesage); //message
				$(".mui-title").html(comdname); //title
				$(".kankan_zanbox").attr("id", comdityid); //praise comdity id
				if(buy_sell_flag=="1"){
					$(".comdinfo").hide();
				}
				if(traslatestautes=="0"){
					if (price > 0) {
						$("#detail_commPrice").text(parseFloat(price).toLocaleString());
					} else {
						$("#detail_commPrice").text(0);
					}
					$(".ka_buyway").hide();
					$("#bottom_price").show();
					$("#traslateing").hide();
				}else{
					$(".ka_buyway").hide();
					$("#bottom_price").hide();
					$("#traslateing").show();
				}
				var imgsarr = commodity.commodity_imgs;
				var htmlimg = "";
				var htmlfocus = "";
				var imglength = imgsarr.length;
				var la = imgsarr.length - 1 * 1;
				if(imgsarr==""){
					imgurl = "../../../images/nopic.jpg";
					htmlimg += '<div class="mui-slider-item sliderimg imgboxs" align="center" style="height:'+screenheight+'px;line-height:'+screenheight+'px;">';
					htmlimg += '<img src="' + imgurl + '" style="max-height: '+screenheight+'px; width: auto;vertical-align:middle; onerror="this.src=' + "'../../../images/nopic.jpg'" + '">';
					htmlimg += '</div>';
					var htmlfocus = '<div class="mui-indicator mui-active"></div>';
					$(".mui-slider-indicator").append(htmlfocus);
				}
				//var first = '<img src="' + imgsarr[0] + '"  style="max-height: 320px; width: auto;vertical-align:middle;" onerror="this.src=' + "'" + '../../../images/nopic.jpg' + "'" + '">';
				//var last = '<img src="' + imgsarr[la] + '"  style="max-height: 320px; width: auto;vertical-align:middle;" onerror="this.src=' + "'" + '../../../images/nopic.jpg' + "'" + '">';
				//$(".firstimage").html(last);
				//$(".lastimage").html(first);
				var leftpx=0;
				for(var i = 0; i < imgsarr.length; i++) {
					var forward=i+1*1;
					var back=i-1*1;
					var imgurl = imgsarr[i].url;
					var realwidth=imgsarr[i].width;
					var realheight=imgsarr[i].height;
					if(realheight<screenheight){
						var biheight=realheight;
					}else{
						var biheight=screenheight;
					}
					var ribi=realwidth/realheight;
					var showwidth=biheight*ribi;
					var cha=showwidth-_w;
					if(cha>0){
						showwidth="100%";
						var showheight="";
						//leftpx=cha/2;
					}else{
						//leftpx=0;
						showwidth="auto";
						var showheight=screenheight+"px";
					}
					
					if(imgsarr[i].url == "") {
						imgurl = "../../../images/nopic.jpg";
					}
					htmlimg += '<div class="mui-slider-item sliderimg imgboxs" align="center" style="height:'+screenheight+'px;line-height:'+screenheight+'px;">';
					if(i>0){
						htmlimg +='<div class="mui-icon mui-icon-back mui-pull-left Arrow leftarrow" onclick="goitem('+back+')"></div>';
					}
					htmlimg += '<img class="cycleImage" src="' + imgurl + '" style="max-height: '+showheight+'; width: '+showwidth+';vertical-align:middle; onerror="this.src=' + "'../../../images/nopic.jpg'" + '">';
					if(i<la){
						htmlimg +='<div class="mui-icon mui-icon-forward mui-pull-left Arrow rightarrow" style="margin-left: 80%;" onclick="goitem('+forward+')"></div>';
					}
					htmlimg += '</div>';
					if(i == 0) {
						var htmlfocus = '<div class="mui-indicator mui-active"></div>';
					} else {
						var htmlfocus = '<div class="mui-indicator"></div>';
					}
					$(".mui-slider-indicator").append(htmlfocus);
					$("img.cycleImage").lazyload({
						threshold: 200,
						placeholder: "../../../images/nopic.jpg",
						effect: "fadeIn",
						failure_limit : 10
					});
				}
				$(".lunboimgbox").html(htmlimg);
				if(imglength > 1) {
					$(".leftarrow").show();
					$(".rightarrow").show();
				} else {
					$(".leftarrow").hide();
					$(".rightarrow").hide();
				}
				var goodcount = commodity.commodity_praise.praise_count;
				$("#zanshu").html(goodcount);
				var comentnum = commodity.commodity_levave_mess.leave_mess_count;
				$("#commentsnum").html(comentnum); //product comment count
				var uname = commodity.user_basic.user_name;
				var uimage = commodity.user_basic.user_photo;
				var userid = commodity.user_basic.user_id;
				var ucomentnum = commodity.user_basic.user_comment_count;
				var uadress = commodity.user_basic.pref_detail;
				var ucomeditynum = commodity.user_basic.user_commodity_count;
				var concernedtitle=TextMessage.det_concerneds;
				$(".concerned").html(concernedtitle);
				$("#userid").val(userid);
				$(".ka_authorname b").html(uname);
				$(".ka_touxiangimg").attr("src", uimage);
				$("img.ka_touxiangimg").lazyload({
					threshold: 200,
					placeholder: "../../../images/nopic.jpg",
					effect: "fadeIn",
					failure_limit: 10
				});
				$(".authcom").html(ucomentnum);
				$(".authcomdnum").html(ucomeditynum);
				$(".kankan_det_locationinfo").html(uadress);
				var authlang = commodity.user_basic.talk_flag;
				authlang = authlang.split(',');
				for(var i = 0; i < authlang.length; i++) {
					if(authlang[i] == 0) {
						$(".lanjp").show();
					}
					if(authlang[i] == 1) {
						$(".lanch").show();
					}
					if(authlang[i] == 2) {
						$(".lanen").show();
					}
					if(authlang[i] == 3) {
						$(".lanhk").show();
					}
				}
				//recommend and concerned products image width
				var recoimgheight=parseInt($(window).width())/4-16;
				var li_height = parseInt($(window).width()) * 0.25 -2;
				//buy way
				var exchange = commodity.commodity_buy_way.exchange;
				var business = commodity.commodity_buy_way.business;
				var gratis = commodity.commodity_buy_way.gratis;
				var price = comdbasic[0].price;
				if(exchange == "1") {
					$("#switchex").show();
				} else {
					$("#switchex").hide();
				}
				if(business == "1") {
					$("#switchp").show();
					$(".comdprice").html(price);
				} else {
					$("#switchp").hide();
				}
				if(gratis == "1") {
					$("#switchsend").show();
				} else {
					$("#switchsend").hide();
				}
				//*************************************recommend
				var recomendhtml2 = "";
				var recomendsarrs = commodity.commodity_recommend;
				var recomdlenght = recomendsarrs.length;
				var recomendsobj = {};
				var recomendaddhtml = ""; //add dom
				var recomendaddfirsthtml = "";
				var c = 0;
				if(recomdlenght>4){
					var recomendhtml = '<div class="mui-slider-item sliderimg">';
					recomendhtml += '<ul class="mui-table-view mui-grid-view">';
				}
				var recomendhtml="";
				for(var j = 0; j < recomdlenght; j++) {
					var k = j + 1 * 1;
					var recomendsobj1 = JSON.stringify(recomendsarrs[j]);
					recomendsobj = $.parseJSON(recomendsobj1);
					var recomdimg = recomendsobj.commodity_thu_photo_url;
					var recomdid = recomendsobj.commodity_id;
					var advflag = recomendsobj.is_ad;
					if(j>=4){
						recomendhtml += '<li class="mui-table-view-cell mui-media mui-col-xs-3 detail" style="height: '+li_height+'px;">';
						recomendhtml += '<a href="detail.html" id="' + recomdid + '" class="ka_imgewh" style="height: '+li_height+'px;">';
						recomendhtml += '<img class="mui-media-object ka_imgewh imageDetail" data-original="' + recomdimg + '">';
						recomendhtml += '</a></li>';
					}
					var vall = k % 4;
					if(vall == 0 || j == recomdlenght - 1) {
						if(j>4){
							recomendhtml += '</ul></div>';
						}
					}
					if(vall == 0 && k < recomdlenght && j!=4) {
						recomendhtml += '<div class="mui-slider-item sliderimg">';
						recomendhtml += '<ul class="mui-table-view mui-grid-view">';
					}

					if(j < 4) {
						recomendaddfirsthtml += '<li class="mui-table-view-cell mui-media mui-col-xs-3 detail" style="height: '+li_height+'px;">';
						recomendaddfirsthtml += '<a href="detail.html" id="' + recomdid + '" class="ka_imgewh" style="height: '+li_height+'px;">';
						recomendaddfirsthtml += '<img class="mui-media-object imageDetail" src="' + recomdimg + '" onerror="this.src=' + "'../../../images/nopic.jpg'" + '">';
						recomendaddfirsthtml += '</a></li>';
						$("#firstremmondul").html(recomendaddfirsthtml);
					}
//					if(j > recomdlenght - 4) {
//						recomendaddhtml += '<li class="mui-table-view-cell mui-media mui-col-xs-3 detail">';
//						recomendaddhtml += '<a href="detail.html" id="' + recomdid + '" class="ka_imgewh">';
//						recomendaddhtml += '<img class="mui-media-object" src="' + recomdimg + '" style="width: 95px;height: 81px;" onerror="this.src=' + "'../../../images/nopic.jpg'" + '">';
//						recomendaddhtml += '</a></li>';
//						$("#lastremmondul").html(recomendaddhtml);
//					}
				}
				recomendhtml2 += recomendhtml;
				$("#firstrecommend").after(recomendhtml);
				//recommend end*********************************/
				//*************************************concenered
				var concernhtml2 = "";
				var concernarrs = commodity.user_praise_commoditys;
				var concernlenght = concernarrs.length;
				var concernsobj = {};
				var concernaddhtml = ""; //add dom
				var concernlastaddhtml = "";
				if(concernlenght>4){
					var concernhtml = '<div class="mui-slider-item sliderimg">';
					concernhtml += '<ul class="mui-table-view mui-grid-view">';
				}
				var concernhtml=""; 
				for(var l = 0; l < concernlenght; l++) {
					var m = l + 1 * 1;
					var concernobj1 = JSON.stringify(concernarrs[l]);
					concernsobj = $.parseJSON(concernobj1);
					var concernimg = concernsobj.commodity_thu_photo_url;
					var concernid = concernsobj.commodity_id;
					if(l >= 4){
						concernhtml += '<li class="mui-table-view-cell mui-media mui-col-xs-3 detail" style="height: '+li_height+'px;">';
						concernhtml += '<a href="detail.html" id="' + concernid + '" class="ka_imgewh" style="height: '+li_height+'px;">';
						concernhtml += '<img class="mui-media-object" data-original="' + concernimg + '" onerror="this.src=' + "'../../../images/nopic.jpg'" + '">';
						concernhtml += '</a></li>';
					}
					var vallm = m % 4;
					if(vallm == 0 || l == concernlenght - 1) {
						if(l>4){
							concernhtml += '</ul></div>';
						}
					}
					if(vallm == 0 && m < concernlenght && l!=4) {
						concernhtml += '<div class="mui-slider-item sliderimg">';
						concernhtml += '<ul class="mui-table-view mui-grid-view">';
					}
					if(l < 4) {
						concernaddhtml += '<li class="mui-table-view-cell mui-media mui-col-xs-3 detail" style="height: '+li_height+'px;">';
						concernaddhtml += '<a href="detail.html" id="' + concernid + '" class="ka_imgewh" style="height: '+li_height+'px;">';
						concernaddhtml += '<img class="mui-media-object" data-original="' + concernimg + '" onerror="this.src=' + "'../../../images/nopic.jpg'" + '">';
						concernaddhtml += '</a></li>';
						$("#firstconcerul").html(concernaddhtml);
					}
//					if(l > concernlenght - 4) {
//						concernlastaddhtml += '<li class="mui-table-view-cell mui-media mui-col-xs-3 detail">';
//						concernlastaddhtml += '<a href="detail.html" id="' + concernid + '" class="ka_imgewh">';
//						concernlastaddhtml += '<img class="mui-media-object" src="' + concernimg + '" style="width: 95px;height: 81px;" onerror="this.src=' + "'../../../images/nopic.jpg'" + '">';
//						concernlastaddhtml += '</a></li>';
//						$("#firstconcerul").html(concernlastaddhtml);
//					}

				}
				concernhtml2 += concernhtml;
				$("#firstconcerned").after(concernhtml2);
				//concenered end**************************************/
				//buy way
				//praise staute
				// add lazyload
				$("img.mui-media-object").lazyload({
					threshold: 200,
					placeholder: "../../../images/nopic.jpg",
					effect: "fadeIn",
					failure_limit: 10
				});
				var user_praise_status = commodity.commodity_praise.user_praise_status;
				if(user_praise_status == "0") {
					$("#zanqian").show();
					$("#zanhou").hide();
				} else {
					$("#zanqian").hide();
					$("#zanhou").show();
				}

				//detail page
				var detailPage = null;
				mui('.detail').on('tap', 'a', function(e) {
					document.body.scrollTop = document.documentElement.scrollTop = 0;
//					emptyhtml();
//					$(".mui-content").hide();
//					$("#loading").show();
					var did = this.getAttribute('id');
					if(!detailPage) {
						detailPage = plus.webview.getWebviewById('detail.html');
					}
					mui.fire(detailPage, 'cid', {
						id: did,
						flag:"concer"
					});
					mui.openWindow({
						id: 'detail.html'
					});
					
				});
				$(".mui-content").show();
				$("#loading").hide();
				//Carousel figure
				var slider = mui("#slider");
				slider.slider({
					interval: 0,
					gotoItem: 0
				});
				
				if(imgsarr==""){
					var imgurl0="";
				}else{
					var murl=imgsarr[0].url;
					var imgurlarr=imgsarr[0].url.split("/");
					var imgurl0="";
					var imgurlpath = murl.substr(0,murl.lastIndexOf("/"));
					var imgurlname = murl.substr(murl.lastIndexOf("/"));
					//console.log(imgurlpath);
					//console.log(imgurlname);
					//console.log(imgurlarr);
					/*for(var m=0;m<imgurlarr.length;m++){
						//console.log(m+":"+imgurlarr[m]);
						if(m<=8){
							imgurl0+=imgurlarr[m]+"/";
						}else{
							imgurl0+="thumbnail/"+imgurlarr[9];
						}
					}*/
					imgurl0 = imgurlpath+'/thumbnail'+imgurlname;
				}
				if(comdmesage.lenght>10){
					var comdetail=comdmesage.substring(0,10)+"......";
				}else{
					var comdetail=comdmesage;
				}
				clickshare(comdityid,imgurl0,comdname,comdetail);
			}
			//products list
			var prolistpage = null;
			mui('.productlist').on('tap', 'a', function(e) {
				var uid = $("#userid").val();
//				if(!prolistpage) {
//					prolistpage = plus.webview.getWebviewById('productslist.html');
//				}
//				mui.fire(prolistpage, 'prolid', {
//					id: uid
//				});
				mui.openWindow({
					id: 'productslist',
					url:'productslist.html?prolid='+uid,
					extras: {
								"prolid": uid
							}
				});
			});
			//messageshow end************/
			//go item
			function goitem(index){
				var gallery = mui('#slider');
				gallery.slider().gotoItem(index);
			}
			//goods
			function dianzan(bid) {
				var codid = $(".kankan_zanbox").attr("id");
				//ajax post 
				var params1 = {
					"commid": codid
				};
				Repository.Commodity.praise(params1, {
					ok: function(data) {
						Log.d("success");
						praise(data);
					},
					ng: function(data) {
						Log.d(data);
						if(data == "1000") {
							mui.toast(TextMessage.test, {
								duration: 'long',
								type: 'div'
							});
							mui.openWindow({
								id: 'login',
								url: "../../login/login.html"
							});
						}
						if(data == "2004") {
							mui.toast(TextMessage.operation_error, {
								duration: 'long',
								type: 'div'
							});
						}
						if(data == "3020") {
							mui.toast(TextMessage.input_email, {
								duration: 'long',
								type: 'div'
							});
							mui.openWindow({
								id: 'emai_summate',
								url: "../../login/emai_summate.html"
							});
						}
					}
				});

			}
			//praise css controll
			function praise(data) {
				var counts=data.data.p_cnt;
				var pflag=data.data.p_flg;
				$("#zanshu").html(counts);
				if(pflag == "1") {
					$("#zanqian").hide();
					$("#zanhou").show();
				} else {
					$("#zanhou").hide();
					$("#zanqian").show();
				}
			}

			//

			function transRequest(params) {
				Repository.Transaction.transRequest(params, {
					ok: function(data) {
						var trans_id = data.data.transinfo[0].trans_id;
						//alert(trans_id);
						var parmain="main";
						mui.openWindow({
							url: "../../transaction/transaction2.html?transid=" + trans_id+"&goparmes=main",
							id: "transaction",
							extras: {
								"transid": trans_id,
								"goparmes":parmain
							}
						})
					},
					ng: function(data) {
						Api.callback_ng(data);
					}
				});
			}
			mui("#bottom_price").on('tap', '#gotobuy', function() {
				// var change_name = $(this).attr("id");
				var mode;
				var codid = $(".kankan_zanbox").attr("id");
				var params = {
					"commodity_id": codid
				};
				var comduid=$("#userid").val();
				var myuid=$("#myid").val();
				var tradeablenum = $("#comm_num").val();
				if(comduid==myuid){
					mui.toast(TextMessage.operation_error, {
						duration: 'long',
						type: 'div'
					});
					return false;
				}
				var login_flag = plus.storage.getItem("LoginFlag");
				if(login_flag != 'isLogin') {
					mui.toast(TextMessage.test, {
						duration: 'long',
						type: 'div'
					});
					mui.openWindow({
						id: 'login',
						url: "../../login/login.html"
					});
				} else {
					if (comm_business == 1) {
						mode = 'business';
						params.mode = mode;
						transRequest(params);
					}
					if (comm_exchange == 1) {
						if(tradeablenum == 0){
							mui.toast(TextMessage.commdNo, {
								duration: 'long',
								type: 'div'
							});
							return false;
						}
						mode = 'exchange';
						params.mode = mode;
						mui.openWindow({
							url: "../../transaction/select_item.html?commodity_id="+codid+"&mode="+mode,
							id: "selectitem",
							extras: {
								"commodity_id": codid,
								"mode": mode
							}
						})
					}
					if (comm_gratis == 0) {
						mode = 'gratis';
						params.mode = mode;
						transRequest(params);
					}
					/*if(change_name == 'switchp') {
						mode = 'business';
						params.mode = mode;
						transRequest(params);
					} else if(change_name == 'switchex') {
						if(tradeablenum == 0){
							mui.toast(TextMessage.commdNo, {
								duration: 'long',
								type: 'div'
							});
							return false;
						}
						mode = 'exchange';
						params.mode = mode;
						mui.openWindow({
							url: "../../transaction/select_item.html?commodity_id="+codid+"&mode="+mode,
							id: "selectitem",
							extras: {
								"commodity_id": codid,
								"mode": mode
							}
						})
					} else {
						mode = 'gratis';
						params.mode = mode;
						transRequest(params);
					}*/
				}
			});
			/*mui(".ka_buyway").on('tap', '.mui-btn', function() {
				var change_name = $(this).attr("id");
				var mode;
				var codid = $(".kankan_zanbox").attr("id");
				var params = {
					"commodity_id": codid
				};
				var comduid=$("#userid").val();
				var myuid=$("#myid").val();
				var tradeablenum = $("#comm_num").val();
				if(comduid==myuid){
					mui.toast(TextMessage.operation_error, {
						duration: 'long',
						type: 'div'
					});
					return false;
				}
				var login_flag = plus.storage.getItem("LoginFlag");
				if(login_flag != 'isLogin') {
					mui.toast(TextMessage.test, {
						duration: 'long',
						type: 'div'
					});
					mui.openWindow({
						id: 'login',
						url: "../../login/login.html"
					});
				} else {
					if(change_name == 'switchp') {
						mode = 'business';
						params.mode = mode;
						transRequest(params);
					} else if(change_name == 'switchex') {
						if(tradeablenum == 0){
							mui.toast(TextMessage.commdNo, {
								duration: 'long',
								type: 'div'
							});
							return false;
						}
						mode = 'exchange';
						params.mode = mode;
						mui.openWindow({
							url: "../../transaction/select_item.html?commodity_id="+codid+"&mode="+mode,
							id: "selectitem",
							extras: {
								"commodity_id": codid,
								"mode": mode
							}
						})
					} else {
						mode = 'gratis';
						params.mode = mode;
						transRequest(params);
					}
				}
			})*/
		    
		    $('#see').text(TextMessage.sharetitle);
		    $('#reportGoods').text(TextMessage.complaintpro);
		    $('#shareFriends').text(TextMessage.towchatfrind);
		    $('#shareCircle').text(TextMessage.towchatcircle);
		    $("[href='#report']").html("<b>" + TextMessage.cancel + "</b>");
		    $("[href='#friendChat']").html("<b>" + TextMessage.cancel + "</b>");
		</script>
	</body>

</html>