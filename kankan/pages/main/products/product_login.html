<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>product_login</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../../../css/mui.min.css">
		<link rel="stylesheet" href="../../../css/kankan_home.css">
		<!--<link href="../../../css/mui.picker.css" rel="stylesheet" />
		<link href="../../../css/mui.poppicker.css" rel="stylesheet" />-->
		<link rel="stylesheet" type="text/css" href="../../../css/public.css">
	    <link rel="stylesheet" type="text/css" href="../../../css/mobileSelect.css">
		<style>
			h5{
				margin-left: 0.2em;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" style="display: none;"></a>
			<h1 class="mui-center mui-title lang" data-locale=""></h1>
		</header>
		<div class="mui-content" style="margin-top: 0.5em;">
			<form action="" method="post" name="publishcomodity" id="publishcomodity">
				<h5 class="ka_proloh5 ka_propicfonts lang" data-locale="commodity_photos" style="margin-top: 0.5em;"></h5>
				<div class="ka_prologbox0 z_photo">
					<div class="z_file" style="background-image: url(../../../images/iconfont-tianjia.png);" id="gallery"></div>
					<div class="mui-pull-right mui-icon mui-icon-camera takepic" id="takepic"></div>
				</div>
				<!--mask-->
				<div class="z_mask">
					<!--alert box-->
					<div class="z_alert">
						<p class="lang" data-locale="commodity_photodet"></p>
						<p>
							<span class="z_cancel lang" data-locale="det_goodconcel"></span>
							<span class="z_sure lang" data-locale="register"></span>
						</p>
					</div>
				</div>
				<br />
				<input type="hidden" name="" id="0" value="0" class="imgname" />
				<input type="hidden" name="" id="1" value="0" class="imgname" />
				<input type="hidden" name="" id="2" value="0" class="imgname" />
				<input type="hidden" name="" id="3" value="0" class="imgname" />
				<div class="ka_prologbox">
					<h5 class="ka_proloh5 lang" data-locale="commodity_name"></h5>
					<ul class="mui-table-view">
						<li class="mui-table-view-cell" style="width: 100%;">
							<input type="text" class="lang" data-locale="commodity_namelength" id="comm_name" name="comm_name" maxlength="40" onfocus="closepicker()" onblur="pickershow()">
						</li>
						<li class="mui-table-view-cell" style="width: 100%;">
							<textarea class="ka_noborder" maxlength="1000" id="comm_detail" name="comm_detail" onfocus="closepicker()" onblur="pickershow()" oninput="daojishu()"></textarea>
							<div class="daojishitext"></div>
						</li>
					</ul>
				</div>
				<br />
				<div class="ka_prologbox">
					<h5 class="ka_proloh5 lang" data-locale="commodity_detail"></h5>
					<ul class="mui-table-view">
						<li class="mui-table-view-cell" style="width: 100%;">
							<div class="mui-navigate-right" id="showCityPicker">
								<span class="ka_proinfo lang" data-locale="commodity_sorts" ></span>
								<div id='sortResult' class="mui-pull-right ka_bitian lang" data-locale="commodity_must" id="bitian1"></div>
								<!--<div  class="ui-alert mui-pull-right ka_sortname"></div>-->
								<input type="hidden" name="classify_id" id="classify_id" value="" />
							</div>

						</li>
						<li class="mui-table-view-cell" style="width: 100%;">
							<div class="mui-navigate-right" id="prostuat">
								<span class="ka_proinfo lang" data-locale="commodity_stuates"></span>
								<div id='stauteResult' class="mui-pull-right ka_bitian lang" data-locale="commodity_must" id="bitian2"></div>
								<!--<div  class="ui-alert mui-pull-right ka_sortname"></div>-->
								<input type="hidden" name="comm_state" id="comm_state" value="" />
							</div>
						</li>
						<li class="mui-table-view-cell" style="display: none;">
							<span class="ka_proinfo lang" data-locale="commodity_price"></span>
							<div class="mui-pull-right">
								<input type="text" name="price" id="price" value="" placeholder="" cla="ka_comdprice" maxlength="10" />
								<span class="comd_login_unit">P</span>
							</div>

						</li>
					</ul>
				</div><br />
				<div class="ka_prologbox">
					<h5 class="ka_proloh5 lang" data-locale="commodity_buyway"></h5>
					<ul class="mui-table-view">
						<li class="mui-table-view-cell" style="text-align:center;width: 100%;">
							<div class="ka_userbox">
								<div class="mui-pull-left ka_exchangegrey lang" data-locale="commodity_switch" id="exchbuybtn" style="display: none;"></div>
								<input type="hidden" name="exchange" id="exchange" value="0" />
								<!--买卖-->
								<div class="mui-pull-left ka_exchangegrey lang" data-locale="commodity_pointbuy" id="pointbuybtn" style="width: 40%; margin-left: 10%;"></div>
								<input type="hidden" name="business" id="business" value="0" />
								<!--免费赠送-->
								<div class="mui-pull-left ka_exchangegrey lang" data-locale="commodity_free" id="freebuybtn" style="width: 40%;"></div>
								<input type="hidden" name="gratis" id="gratis" value="0" />
							</div>
						</li>
					</ul>
				</div>
				<!--商品价格start-->
				<div>
					<h5 class="ka_proloh5 lang" data-locale="commodity_price" style="margin: 1.5em 0 1.5em 0.5em"></h5>
					<div class="inputPrice">
						<input id="number_price" type="number" onkeyup="getNumber()" class="inputNumber" disabled="true"/>
						<span class="inputSpan">&yen;<span id="input_price"></span></span>
					</div>
                </div>
				<!--商品价格end-->
				<!--Trading interest start-->
				<div class="tradeFees">
					<ul class="mui-table-view ka_prologbox">
						<li class="mui-table-view-cell" style="width: 100%;">
						    <span class="ka_proinfo lang mui-col-xs-9" data-locale="commodity_transactionFees"></span>
						    <span class="fee mui-col-xs-3">¥<span id="trans_fees"></span></span>
						</li>
						<li class="mui-table-view-cell" style="width: 100%;">
						    <span class="ka_proinfo lang mui-col-xs-9" data-locale="commodity_tradingIncome"></span>
						    <span class="fee mui-col-xs-3">¥<span id="trading_income"></span></span>
						</li>
					</ul>
				</div>
				<!--Trading interest end-->
				<div class="ka_description lang" data-locale="commodity_forbidentext"></div>
				<div class="ka_userbox">
					<button type="button" class="mui-btn mui-btn-blue ka_prologsure lang" data-locale="" id="waste" style="margin-top: 1em;display: none;" onclick="wastes()"></button>
					<button type="button" class="mui-btn mui-btn-grey ka_prologsure lang" data-locale="deletebut" id="delete" style="margin-top: 1em;display: none;" onclick="submitdelete()"></button>
					<button type="button" class="mui-btn mui-btn-red ka_prologsure lang" data-locale="commodity_buttonsure" style="margin-top: 1em;" onclick="publishscheck()" id="submit"></button>
				</div>
				<br/>
				<div class="showimg"></div>
				<div id="deltimg" style="display: none;"></div>
				<input type="hidden" name="codid" id="codid" value="" />
				<input type="hidden" name="commstautes" id="commstautes" value="" />
				<div id="photoLeft" class="mui-popover mui-popover-action mui-popover-bottom">
					<ul class="mui-table-view tickimgbox">
						<li style="display: block;" class="mui-table-view-cell">
							<a id="chooseImage" style="color: #9C9C9C" disabled="true"></a>
						</li>
						<li style="display: block;" class="mui-table-view-cell">
							<a id="fromChoose" onclick="galleryImg()" style="color: #007aff"></a>
						</li>
					</ul>
					<ul class="mui-table-view tickimgbox">
						<li style="display: block;" class="mui-table-view-cell">
							<a href="#photoLeft" style="color: #007aff"></a>
						</li>
					</ul>
		        </div>
			    <div id="photoRight" class="mui-popover mui-popover-action mui-popover-bottom">
					<ul class="mui-table-view tickimgbox">
						<li style="display: block;" class="mui-table-view-cell">
							<a id="comdity_takepic" style="color: #9C9C9C" disabled="true"></a>
						</li>
						<li  style="display: block;" class="mui-table-view-cell">
							<a id="tackpicture" onclick="getImage()" style="color: #007aff"></a>
						</li>
					</ul>
					<ul class="mui-table-view tickimgbox">
						<li style="display: block;" class="mui-table-view-cell">
							<a href="#photoRight" style="color: #007aff"></a>
						</li>
					</ul>
		        </div>
			</form>
		</div>
	</body>
	<script src="../../../js/mui.min.js"></script>
	<script src="../../../js/mui.view.js "></script>
	<script src="../../../js/common.js"></script>
	<!--<script src="../../../js/mui.picker.js"></script>
	<script src="../../../js/picker/mui.poppicker.js"></script>-->
	<script src="../../../js/jquery-3.2.0.min.js"></script>
	<script src="../../../js/language.js"></script>
	<script src="../../../js/sha256.js"></script>
	<script src="../../../js/pro_uploadimg.js"></script>
	<script src="../../../js/mobileSelect.js" type="text/javascript"></script>
	<script>
		mui.init({
			beforeback: function() {
				var list = plus.webview.currentWebview().opener();
				mui.fire(list, 'refreshlist');
				return true;
			}
		});
		$(function() {
			$(".ka_noborder").attr("placeholder", TextMessage.commodity_descriptionlength);
			$(".mui-title").html(TextMessage.commodity_login);
		});
	var id;
	var testarr=[];
	var catearrs=[{data:[]}];
	var positions='0';
	//getprice
	var price_max = 0;
	var price_min = 0;
	var charge_rate = 0; //rate
	var mobileSelect4;
	var stautsSelect;
	var stautesposition='0';
	var statedate = [{data:[{
						id: '0',
						value: TextMessage.prostaute0
					}, {
						id: '1',
						value: TextMessage.prostaute1
					}, {
						id: '2',
						value: TextMessage.prostaute2
					}, {
						id: '3',
						value: TextMessage.prostaute3
					}]}];
		
	mui.plusReady(function() {
		var params = {};
		Repository.Commodity.getPrice(params, {
			ok: function(data) {
				console.log("success");
				showPrice(data);
			},
			ng: function(data) {
				console.log("error:"+data);
				Log.d(data);
			}
		});
		
		var self = plus.webview.currentWebview();
		id = self.eid;
		if(id){
			$(".z_addImg").remove();
			$(".mui-action-back").show();
			document.getElementById('codid').value=id;
			$("#delete").show();
			getcomdinfo(id);
		}else{
			stautsSelect= new MobileSelect({
			    trigger: '#stauteResult',
			    title: '',
			    wheels: statedate, 
			    position:'0',
			    transitionEnd:function(indexArr, data){
			    	if(indexArr=="NAN"){
			    		indexArr=stautesposition;
			    	}
			        console.log(indexArr);
			    },
			    callback:function(indexArr, data){
			        console.log(data[0].id);
			        $("#comm_state").val(data[0].id);
			        $("#stauteResult").text(data[0].value);
			        $("#stauteResult").removeClass("ka_bitian");
			        $("#stauteResult").addClass("ka_sortname");					       
			    }  
			});
			var param2 = {
				"flg": "classify"
			};
			Repository.Commodity.category(param2, {
				ok: function(data) {
					console.log("success");
					catearrs[0].data =categorypushnew(data);
					mobileSelect4 = new MobileSelect({
					    trigger: '#sortResult',
					    title: '',
					    wheels: catearrs, 
					    position:'0,0',
					    transitionEnd:function(indexArr, data){
					    	if(indexArr=="NAN"){
					    		indexArr=positions;
					    	}
					        console.log(indexArr);
					    },
					    callback:function(indexArr, data){
					        console.log(data[1].id);
					       document.getElementById("classify_id").value=data[1].id;
						   document.getElementById("sortResult").setAttribute("class","ka_sortname mui-pull-right");
					    }  
					});
					//var catearrs = categorypush(data);
					//sortpicker(catearrs);
				},
				ng: function(data) {
					console.log("error" + data);
					Api.callback_ng(data);
				}
			});
		}
	});
	function showPrice(results) {
		var resultsData = results.data;
		price_max = resultsData[0].price_max;
		price_min = resultsData[1].price_min;
		charge_rate = resultsData[2].charge_rate;
	}
	window.addEventListener("refresh", function(event) {
		location.reload();
	});
	window.addEventListener("refreshtop", function(event) {
		document.body.scrollTop = document.documentElement.scrollTop = 0;
	});
	function daojishu(){
		var delength=$("#comm_detail").val().trim().length;
		var cha=1000-delength;
		//var texts=TextMessage.inputtext+"<font color='red'>"+cha+"</font>"+TextMessage.inputpoint;
		var texts="<font color='#ACACB4'>"+delength+"/1000</font>";
		$(".daojishitext").html(texts);
	}
	//getNumber
	function getNumber() {
		var number_price = $("#number_price").val();
		if (parseInt(number_price) < price_min || parseInt(number_price) > price_max ) {
		    mui.alert(TextMessage.numberRangeText);
		}
		
		$("#input_price").html(parseFloat(Math.floor(number_price)).toLocaleString());
	    $("#trans_fees").html(parseFloat(Math.floor(number_price * charge_rate / 100)).toLocaleString());
	    $("#trading_income").html(parseFloat(Math.floor(number_price) - Math.floor(number_price * charge_rate / 100)).toLocaleString());
	}
	function closepicker(){
		preventKeyBoardSubmit.closekeybord();
		$(".mui-poppicker").hide();
	}
	//input lose focus show picker
	function pickershow(){
		$(".mui-poppicker").show();
	}
	//make input lose focus
	function inputblur(){
		document.getElementById('comm_name').blur();
		document.getElementById('comm_detail').blur();
	}
	//edite image show
	function imagepull(im,srcval,imgWidth, imgHeight){
	    var imgwidth = parseInt($(window).width()) / 4 - 33.75;
	    var hwhpercent = imgHeight / imgWidth;
	    var top_margin = 0;
	    var showheight = imgwidth * hwhpercent;
	    var cha1 = showheight - imgwidth;
	    if(cha1 > 0) {
		    top_margin = cha1 / 2;
	    } else {
		    top_margin = 0;
	    }
	    
	    if (showheight < imgwidth) {
            imgdiv="position: relative; top: "+(imgwidth-showheight)/2+"px;";
		} else {
			imgdiv="height:"+ imgwidth +"px; overflow: hidden; line-height: "+ imgwidth +"px;";
		}
		var styleimg="height: auto; margin-top:-"+ top_margin +"px;";
		
		
		var img = document.createElement("img");
		img.setAttribute("src", srcval);
		img.setAttribute("alt", im);
		img.setAttribute("onerror", "this.src='../../../images/nopic.jpg'");
		img.setAttribute("class", "z_images");
		img.setAttribute("style", styleimg);
		var imgAdd = document.createElement("div");
		imgAdd.setAttribute("class", "z_addImg");
		imgAdd.setAttribute("style", imgdiv);
		imgAdd.appendChild(img);
		$(".z_photo").append(imgAdd);
		imglength();
		imgRemove();
	}
	//edite information show
	function messages(results){
		$(".mui-title").html(TextMessage.commodity_edit);
		$("#0").val("0");
		$("#1").val("0");
		$("#2").val("0");
		$("#3").val("0");
		var name=HTMLDecode(HTMLDecode(results.data.comm_name));
		var detail=HTMLDecode(HTMLDecode(results.data.comm_detail));
		var business=results.data.business;
		var exchange=results.data.exchange;
		var gratis=results.data.gratis;
		var image0=results.data.imges[0];
		var image1=results.data.imges[1];
		var image2=results.data.imges[2];
		var image3=results.data.imges[3];
		var classify_id=results.data.classify_id;
		var state=results.data.state;
		var commstautes=results.data.comm_status;
	    var price = results.data.price;
	    var rate = results.data.service_charge;
	    var profile = results.data.profit;
		if(commstautes=="0"){
		//waste product
			$("#waste").show();
			$("#waste").text(TextMessage.commodity_luo);
			$("#commstautes").val("2");
		}
		if(commstautes=="4"){
		//again submit product
			$("#waste").show();
			$("#waste").text(TextMessage.commodity_againlogin);
			$("#commstautes").val("1");
		}
		document.getElementById('comm_name').value=name;
		document.getElementById('comm_detail').value=detail;
		document.getElementById('business').value=business;
		document.getElementById('exchange').value=exchange;
		document.getElementById('gratis').value=gratis;
		document.getElementById('classify_id').value=classify_id;
		document.getElementById('comm_state').value=state;
		$("#number_price").val(price);
		$("#input_price").html(parseFloat(price).toLocaleString());
		$("#trans_fees").html(parseFloat(rate).toLocaleString());
		$("#trading_income").html(parseFloat(profile).toLocaleString());
		$("#stauteResult").removeClass("ka_bitian");
		$("#stauteResult").addClass("ka_sortname");
		if(state=="0"){
			$("#stauteResult").html(TextMessage.prostaute0);
		}else if(state=="1"){
			$("#stauteResult").html(TextMessage.prostaute1);
		}else if(state=="2"){
			$("#stauteResult").html(TextMessage.prostaute2);
		}else{
			$("#stauteResult").html(TextMessage.prostaute3);
		}
		if(image0!=""){
			document.getElementById('0').value=image0.imgurl;
			imagepull(0,image0.imgurl,image0.imgwidth, image0.imgheight);
		}
		if(image1!=""){
			document.getElementById('1').value=image1.imgurl;
			imagepull(1,image1.imgurl,image1.imgwidth, image1.imgheight);
		}
		if(image2!=""){
			document.getElementById('2').value=image2.imgurl;
			imagepull(2,image2.imgurl, image2.imgwidth, image2.imgheight);
		}
		if(image3!=""){
			document.getElementById('3').value=image3.imgurl;
			imagepull(3,image3.imgurl, image3.imgwidth, image3.imgheight);
		}
		if(business=="1"){
			$("#number_price").removeAttr("disabled");
			$("#pointbuybtn").removeClass("ka_exchangegrey");
			$("#pointbuybtn").addClass("ka_exchangered");
		}
		if(exchange=="1"){
			$("#exchbuybtn").removeClass("ka_exchangegrey");
			$("#exchbuybtn").addClass("ka_exchangered");
		}
		if(gratis=="1"){
			$("#freebuybtn").removeClass("ka_exchangegrey");
			$("#freebuybtn").addClass("ka_exchangered");
		}
	}
	//edite show
	function getcomdinfo(dataid){
			var param3={
				"commodity_id":dataid
			}
			Repository.Commodity.Commodityedite(param3, {
						ok: function(data) {
							console.log("success");
							messages(data);
							var catid = data.data.classify_id; //second category value
							//var pickcatarr = categorychoose(catearrs, catid); //selected category value
							var stautid = data.data.state;
							selectdefault(catid,stautid);
						},
						ng: function(data) {
							console.log("error:"+data);
							if(data == "1000") {
								mui.toast(TextMessage.test, {
									duration: 'long',
									type: 'div'
								});
								mui.openWindow({
									id: 'login',
									url:"../../login/login.html"
								});
							}
							if(data=="2002"){
								mui.toast(TextMessage.userng, {
									duration: 'long',
									type: 'div'
								});
								mui.openWindow({
									id: 'login',
									url:"../../login/login.html"
								});
							}
							//Api.callback_ng(data);
						}
			});
		
	}
	//get classfiy 
	function categorypushnew(results){
		var catedata=results.data;
		for(var c=0;c<catedata.length;c++){
			var categoryadd={
					id: catedata[c].catalog_id,
					value: catedata[c].catalog_detail,
					childs: []
				};
				if(catedata[c].children) {
					var childrenarr = categoryadd.childs;
					var secondcatearr = catedata[c].children;
					for(var t = 0; t < secondcatearr.length; t++) {
						var childrenadd = {
							id: secondcatearr[t].classify_id,
							value: secondcatearr[t].classify_detail
						}
						childrenarr.push(childrenadd);
					}
					testarr.push(categoryadd);
				}

			}
			return testarr;
	}
	function categorychoose(catearr,catid,flag) {
		var arrs=catearr;
		for(var ci = 0; ci < arrs.length; ci++) {
			var childredarr = arrs[ci].childs;
			for(var di = 0; di < childredarr.length; di++) {
				if(childredarr[di].id == catid) {
					//return catearr[ci];
					if(flag){
						return arrs[ci].value+" "+childredarr[di].value;
					}else{
						return ci+","+di;
					}
					break;
				}
			}
		}
	}

	function childrentext(stautid) {
		var childredarr=statedate[0].data;
		for(var chd = 0; chd < childredarr.length; chd++) {
			if(childredarr[chd].id == stautid) {
				//return childredarr[chd].text;
				return chd;
				break;
			}
		}
	}
	function selectdefault(catid,stautid){
		stautesposition=childrentext(stautid)+",";
		stautsSelect= new MobileSelect({
				    trigger: '#stauteResult',
				    title: '',
				    wheels: statedate, 
				    position:stautesposition,
				    transitionEnd:function(indexArr, data){
				    	if(indexArr=="NAN"){
				    		indexArr=stautesposition;
				    	}
				        console.log(indexArr);
				    },
				    callback:function(indexArr, data){
				        console.log(data[0].id);
				        $("#comm_state").val(data[0].id);
				        $("#stauteResult").text(data[0].value);
				        $("#stauteResult").removeClass("ka_bitian");
				        $("#stauteResult").addClass("ka_sortname");					       
				    }  
				});
		var param2 = {
						"flg": "classify"
					};
		Repository.Commodity.category(param2, {
			ok: function(data) {
				catearrs[0].data =categorypushnew(data);
				$("#sortResult").addClass("ka_sortname");
				$("#sortResult").removeClass("ka_bitian");
				var cateval=categorychoose(catearrs[0].data,catid,"value");
				$("#sortResult").text(cateval);
				var category=categorychoose(catearrs[0].data,catid);
				var categoryarr=category.split(',');
				positions=category;
				console.log(category);
				mobileSelect4 = new MobileSelect({
				    trigger: '#sortResult',
				    title: '',
				    wheels: catearrs, 
				    position:category,
				    value2:categoryarr[0],
				    transitionEnd:function(indexArr, data){
				    	if(indexArr=="NAN"){
				    		indexArr=positions;
				    	}
				        console.log(indexArr);
				    },
				    callback:function(indexArr, data){
				        console.log(data[1].id);
				        document.getElementById("classify_id").value=data[1].id;
						document.getElementById("sortResult").setAttribute("class","ka_sortname mui-pull-right");
				    }  
				});
			},
			ng: function(data) {
				console.log("error" + data);
				Api.callback_ng(data);
			}
		});
	}
//		function categorypush(results){
//			var catedata=results.data;
//			for(var c=0;c<catedata.length;c++){
//				var categoryadd={
//						value: catedata[c].catalog_id,
//						text: catedata[c].catalog_detail,
//						children: []
//					};
//					if(catedata[c].children) {
//						var childrenarr = categoryadd.children;
//						var secondcatearr = catedata[c].children;
//						for(var t = 0; t < secondcatearr.length; t++) {
//							var childrenadd = {
//								value: secondcatearr[t].classify_id,
//								text: secondcatearr[t].classify_detail
//							}
//							childrenarr.push(childrenadd);
//						}
//						testarr.push(categoryadd);
//					}
//	
//				}
//				return testarr;
//			}

//		function categorychoose(catearr, catid) {
//			for(var ci = 0; ci < catearr.length; ci++) {
//				var childredarr = catearr[ci].children;
//				for(var di = 0; di < childredarr.length; di++) {
//					if(childredarr[di].value == catid) {
//						return catearr[ci];
//						break;
//					}
//				}
//			}
//		}
//
//		function childrentext(childredarr, catid) {
//			for(var chd = 0; chd < childredarr.length; chd++) {
//				if(childredarr[chd].value == catid) {
//					return childredarr[chd].text;
//					break;
//				}
//			}
//		}
		//picker
		//(function($, doc) {
//			$.init({
//				beforeback: function() {
//					var list = plus.webview.currentWebview().opener();
//					mui.fire(list, 'refreshlist');
//					return true;
//				}
//			});
			//$.ready(function() {
				//commodity sort
//				function sortpicker(catearrs) {
//					//commodity category
//					var categoryPicker = new $.PopPicker({
//						layer: 2
//					});
//					categoryPicker.setData(catearrs);
//					//commodity use stuate
//					var statedate = [{
//						value: '0',
//						text: TextMessage.prostaute0
//					}, {
//						value: '1',
//						text: TextMessage.prostaute1
//					}, {
//						value: '2',
//						text: TextMessage.prostaute2
//					}, {
//						value: '3',
//						text: TextMessage.prostaute3
//					}];
//					var statePicker = new $.PopPicker();
//					statePicker.setData(statedate);
//
//					//window.addEventListener('eid', function(event) {
//						var selfs = plus.webview.currentWebview();
//						var picksortid = selfs.eid;
//						//var picksortid = event.detail.id;
//					if(picksortid){
//						var param4 = {
//							"commodity_id": picksortid
//						}
//						Repository.Commodity.Commodityedite(param4, {
//							ok: function(data) {
//								console.log("success");
//								var catid = data.data.classify_id; //second category value
//								var pickcatarr = categorychoose(catearrs, catid); //selected category value
//								var stautid = data.data.state;
//								//console.dir(pickcatarr);
//								var firstcateval = pickcatarr.value; //first category value
//								//set category picker Default value
//								categoryPicker.pickers[0].setSelectedValue(firstcateval, 0, function() {
//									setTimeout(function() {
//										categoryPicker.pickers[1].setSelectedValue(catid);
//									}, 10);
//								});
//								var childrentextcat = childrentext(pickcatarr.children, catid);
//								document.getElementById("bitian1").style.display = "none";
//								doc.getElementById('sortResult').innerText = pickcatarr.text + " " + childrentextcat;
//								//set use state picker Default value
//								statePicker.pickers[0].setSelectedValue(stautid);
//								document.getElementById("bitian2").style.display = "none";
//								var childrentextstate = childrentext(statedate, stautid);
//								document.getElementById('stauteResult').innerHTML = childrentextstate;
//							},
//							ng: function(data) {
//								Log.d(data);
//								if(data == "1000") {
//									mui.toast(TextMessage.test, {
//										duration: 'long',
//										type: 'div'
//									});
//									mui.openWindow({
//										id: 'login',
//										url: "../../login/login.html"
//									});
//								}
//								if(data == "3020") {
//									mui.toast(TextMessage.input_email, {
//										duration: 'long',
//										type: 'div'
//									});
//									mui.openWindow({
//										id: 'emai_summate',
//										url: "../../login/emai_summate.html",
//										extras: {
//											formPageName: "product_login"
//										}
//									});
//								}
//								if(data == "2002") {
//									mui.toast(TextMessage.userng, {
//										duration: 'long',
//										type: 'div'
//									});
//									mui.openWindow({
//										id: 'login',
//										url: "../../login/login.html"
//									});
//								}
//								Api.callback_ng(data);
//							}
//				});
//			}
//			//});
//			//category click picker
////			var showCatePickerButton = doc.getElementById('showCityPicker');
////			var cateResult = doc.getElementById('sortResult');
////			showCatePickerButton.addEventListener('tap', function(event) {
////			  	inputblur();
////				categoryPicker.show(function(items) {
////					cateResult.innerText = items[0].text + " " + items[1].text;
////					document.getElementById("classify_id").value = items[1].value;
////					document.getElementById("bitian1").style.display = "none";
////				});
////			}, false);
////			//staute click Picker
////			var showstatePickerButton = doc.getElementById('prostuat');
////			var stauteResult = doc.getElementById('stauteResult');
////			showstatePickerButton.addEventListener('tap', function(event) {
////				inputblur();
////				statePicker.show(function(items) {
////					stauteResult.innerText = items[0].text;
////					document.getElementById('comm_state').value = items[0].value;
////					document.getElementById("bitian2").style.display = "none";
////				});
////			}, false);
//		}
//	});
//})(mui, document);
//email check
function publishscheck(){
	if (!Repository.User.isEmptyEmail()) {
		 return;
	}else{
		publishs();
	}
}

function removeComma(str) { 
    str = str.replace(/,/g, "");
    return str; 
} 
//submit form
function publishs() {
	var buy_sell_flag = "0";
	var comm_name = HTMLEncode($("#comm_name").val());
	var comm_detail = HTMLEncode($("#comm_detail").val());
	var classify_id = $("#classify_id").val();
	var comm_state = $("#comm_state").val();
	var exchange = $("#exchange").val();
	var business = $("#business").val();
	var gratis = $("#gratis").val();
	var imges0 = $("#0").val();
	var imges1 = $("#1").val();
	var imges2 = $("#2").val();
	var imges3 = $("#3").val();
	var price = $("#number_price").val();
	var service_charge = removeComma($("#trans_fees").html());
	var profit = removeComma($("#trading_income").html());
	
	if(imges0 == "0" & imges1 == "0" & imges2 == "0" & imges3 == "0") {
		mui.toast(TextMessage.pro_imagetest, {
			duration: 'long',
			type: 'div'
		});
		return false;
	}
	if(comm_name.trim()== "") {
		mui.toast(TextMessage.pro_nametest, {
			duration: 'long',
			type: 'div'
		});
		document.publishcomodity.comm_name.focus();
		return false;
	}
	var regStr = /[\uD83C|\uD83D|\uD83E][\uDC00-\uDFFF][\u200D|\uFE0F]|[\uD83C|\uD83D|\uD83E][\uDC00-\uDFFF]|[0-9|*|#]\uFE0F\u20E3|[0-9|#]\u20E3|[\u203C-\u3299]\uFE0F\u200D|[\u203C-\u3299]\uFE0F|[\u2122-\u2B55]|\u303D|[\A9|\AE]\u3030|\uA9|\uAE|\u3030/ig;
	if(regStr.test(comm_name)){
	　　mui.toast(TextMessage.noemjoy, {
			duration: 'long',
			type: 'div'
		});
		document.publishcomodity.comm_name.focus();
		return false;
	}
	if(comm_name.trim().length>40){
		mui.toast(TextMessage.pro_namelength, {
			duration: 'long',
			type: 'div'
		});
		return false;
	}
	if(comm_detail.trim()== "") {
		mui.toast(TextMessage.pro_descriptiontest, {
			duration: 'long',
			type: 'div'
		});
		document.publishcomodity.comm_detail.focus();
		return false;
	}
	if (price.length == 0) {
		mui.toast(TextMessage.pro_pricenulltest, {
			duration: 'long',
			type: 'div'
		});
		return false;
	}
	if(regStr.test(comm_detail)){
	　　mui.toast(TextMessage.noemjoy, {
			duration: 'long',
			type: 'div'
		});
		document.publishcomodity.comm_detail.focus();
		return false;
	}
	if(comm_detail.trim().length >1000) {
		mui.toast(TextMessage.TextMessage.pro_detaillength, {
			duration: 'long',
			type: 'div'
		});
	}
	if(classify_id == "") {
		mui.toast(TextMessage.pro_sorttest, {
			duration: 'long',
			type: 'div'
		});
		return false;
	}
	if(comm_state == "") {
		mui.toast(TextMessage.pro_stautetest, {
			duration: 'long',
			type: 'div'
		});
		return false;
	}
	if(business== "1") {
		if(price==""){
			mui.toast(TextMessage.pro_pricenulltest, {
				duration: 'long',
				type: 'div'
			});
			document.publishcomodity.price.focus();
			return false;
		}
		if(isNaN(price)) {
			mui.toast(TextMessage.pro_pricetest, {
				duration: 'long',
				type: 'div'
			});
			document.publishcomodity.price.focus();
			return false;
		}
		if(price < 0) {
			mui.toast(TextMessage.pro_pricenumbtest, {
				duration: 'long',
				type: 'div'
			});
			document.publishcomodity.price.focus();
			return false;
		}
	}
	if(exchange == "0" & business == "0" & gratis == "0") {
		mui.toast(TextMessage.pro_buywaytest, {
			duration: 'long',
			type: 'div'
		});
		return false;
	}
	
	/*$("#submit").attr("disabled","disabled");*/
	var params = {
		"buy_sell_flag": buy_sell_flag,
		"comm_name": comm_name,
		"comm_detail": comm_detail,
		"classify_id": classify_id,
		"comm_state": comm_state,
		"exchange": exchange,
		"business": business,
		"gratis": gratis,
		"imges[0]": imges0,
		"imges[1]": imges1,
		"imges[2]": imges2,
		"imges[3]": imges3
	};
	if(price!=""){
		params.price=price;
		params.service_charge = service_charge;
		params.profit = profit;
	}
	if(id!=0){
		var commodity_ids=$("#codid").val();
		params.commodity_id=commodity_ids;
	}
	Repository.Commodity.Commoditypublish(params, {
		ok: function(data) {
			Log.d("success");
			mui.toast(TextMessage.pro_logininfo, {
				duration: 'long',
				type: 'div'
			});
			if(!id){
				location.reload();
				mui.plusReady(function() {
					var mainpage=plus.webview.getLaunchWebview();
					 mui.fire(mainpage,'gohome');
				});
				
			}else{
				location.reload();
				mui.back();
			}
		},
		ng: function(data) {
			Log.d(data);
			if(data == "1000") {
				mui.toast(TextMessage.test, {
					duration: 'long',
					type: 'div'
				});
				mui.openWindow({
					id: 'login',
					url:"../../login/login.html"
				});
			} 
			if(data=="2002"){
				mui.toast(TextMessage.userng, {
					duration: 'long',
					type: 'div'
				});
				mui.openWindow({
					id: 'login',
					url:"../../login/login.html"
				});
			}
			if(data=="2007"){
				mui.toast(TextMessage.ticketng, {
					duration: 'long',
					type: 'div'
				});
				location.reload();
				mui.openWindow({
					id: 'point_to_ticket',
					url:"../sttting/point_to_ticket.html"
				});
			}
			Api.callback_ng(data);
			//location.reload();
			//mui.back();
			console.log("other error code:" + data);
			
		},
		error:function(){
			error_tost.message();
			location.reload();
		}
	});

}

//************************buy way choose*****************************
/*exchange*/
document.getElementById('exchbuybtn').addEventListener('tap', function(e) {
	inputblur();
	var exchangeval=$("#exchange").val();
	if(exchangeval=="0"){
		$("#exchange").val("1");
		$("#exchbuybtn").removeClass("ka_exchangegrey");
		$("#exchbuybtn").addClass("ka_exchangered");
	}else{
		$("#exchange").val("0");
		$("#exchbuybtn").removeClass("ka_exchangered");
		$("#exchbuybtn").addClass("ka_exchangegrey");
	}
	if($("#gratis").val() == "1") {
		$("#gratis").val("0");
		$("#freebuybtn").removeClass("ka_exchangered");
		$("#freebuybtn").addClass("ka_exchangegrey");
	}
});
/*point*/
document.getElementById('pointbuybtn').addEventListener('tap', function(e) {
	inputblur();
	var businessval=$("#business").val();
	if(businessval=="0"){
		$("#business").val("1");
		$("#number_price").removeAttr("disabled");
		$("#pointbuybtn").removeClass("ka_exchangegrey");
		$("#pointbuybtn").addClass("ka_exchangered");
	}else{
		$("#business").val("0");
		$("#number_price").attr("disabled", "true");
		$("#pointbuybtn").removeClass("ka_exchangered");
		$("#pointbuybtn").addClass("ka_exchangegrey");
	}
	
	if($("#gratis").val() == "1") {
		$("#gratis").val("0");
		$("#freebuybtn").removeClass("ka_exchangered");
		$("#freebuybtn").addClass("ka_exchangegrey");
	}
});
/*free*/
document.getElementById('freebuybtn').addEventListener('tap', function(e) {
	inputblur();
	var gratisval=$("#gratis").val();
	$("#number_price").attr("disabled", "true");
	if(gratisval=="0"){
		$("#gratis").val("1");
		$("#freebuybtn").removeClass("ka_exchangegrey");
		$("#freebuybtn").addClass("ka_exchangered");
	}else{
		$("#gratis").val("0");
		$("#freebuybtn").removeClass("ka_exchangered");
		$("#freebuybtn").addClass("ka_exchangegrey");
	}
	
	if($("#business").val() == "1") {
		$("#business").val("0");
		$("#pointbuybtn").removeClass("ka_exchangered");
		$("#pointbuybtn").addClass("ka_exchangegrey");
	}
	if($("#exchange").val() == "1") {
		$("#exchange").val("0");
		$("#exchbuybtn").removeClass("ka_exchangered");
		$("#exchbuybtn").addClass("ka_exchangegrey");
	}
});
//delete product
function submitdelete(){
	var deid=$("#codid").val();
	var btnArray = [TextMessage.sure, TextMessage.cancel];
	var paramsde={
		"commodity_id":deid,
	};
	mui.confirm(TextMessage.delmessage, TextMessage.sharetitle, btnArray, function(e) {
		if (e.index == 0) {
			mui.plusReady(function() {
				Repository.Commodity.delete_pro(paramsde, {
					ok:function(data){
						mui.toast(TextMessage.delete_success, {
							duration: 'long',
							type: 'div'
						});
						location.reload();
						mui.back();
					},
					ng:function(data){
						Api.callback_ng(data);
					},
					error:function(){
						error_tost.message();
						location.reload();
					}
				});
			});
		}
	});
	
}
//waste product
function wastes(){
	var deid=$("#codid").val();
	var comm_status=$("#commstautes").val();
	var paramsw={
		"commodity_id":deid,
		"sell_off_flg":comm_status
	};
	if(comm_status==1){
		var buttext=TextMessage.commodity_luo;
		var mestext=TextMessage.comoditylogin_success;
		var butval=4;
	}else{
		var buttext=TextMessage.commodity_againlogin;
		var mestext=TextMessage.luopin_success;
		var butval=1;
	}
	mui.plusReady(function() {
		Repository.Commodity.Commoditypublish(paramsw, {
			ok:function(data){
				mui.toast(mestext, {
					duration: 'long',
					type: 'div'
				});
				$("#waste").text(buttext);
				$("#commstautes").val(butval);
				//location.reload();
				//mui.back();
			},
			ng:function(data){
				Api.callback_ng(data);
				mui.back();
			},
			error:function(){
				error_tost.message();
				location.reload();
			}
		});
	});
}
$('#chooseImage').text(TextMessage.chooseimage);
$('#fromChoose').text(TextMessage.gallerychoose);
$('#comdity_takepic').text(TextMessage.comdity_takepic);
$('#tackpicture').text(TextMessage.tackpicture);
$("[href='#photoLeft']").html("<b>" + TextMessage.cancel + "</b>");
$("[href='#photoRight']").html("<b>" + TextMessage.cancel + "</b>");

</script>

</html>