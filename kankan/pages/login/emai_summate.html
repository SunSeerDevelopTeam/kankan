<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>email_summate</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
		    <h1 class="mui-title">emai完善</h1>
		</header>
		<div style="text-align: left;margin-top: 50px;margin-bottom: -2.5em;"><p><font color="red">*</font>请先完善邮箱资料</p></div>
		<div class="mui-content">
        	<div class="mui-input-group">
				<div class="mui-input-row">
					<label for="email" class="lang" data-locale="email"></label>
					<input id='email' name="email" type="email" class="mui-input lang" data-locale="please-input-email">
				</div>
			</div>
			<!-- send verification code button -->
			<div class="mui-content-padded">
				<div id='send-verification-code' class="mui-btn mui-btn-block mui-btn-success lang" data-locale="send-verification-code"></div>
			</div>
			<div class="mui-input-group">
				<div class="mui-input-row">
					<label class="lang" data-locale="verification-code"></label>
					<input id='verificationCode' name="verificationCode" type="text" class="mui-input-clear mui-input lang" data-locale="please-input-verification-code">
				</div>
			</div>
			<!-- submit button -->
			<div class="mui-content-padded">
				<button id='reg' type="button" class="mui-btn mui-btn-block mui-btn-danger lang" data-locale="register"></button>
			</div>
		</div>
		<script src="../../js/mui.min.js"></script>
		<script type="text/javascript" src="../../js/jquery-3.2.0.min.js"></script>
		<script type="text/javascript" src="../../js/language.js"></script>
		<script type="text/javascript" src="../../js/sha1.js"></script>
		<script type="text/javascript" src="../../js/sha256.js"></script>
		<script type="text/javascript" src="../../js/common.js"></script>
		<script type="text/javascript">
			mui.init();
			mui.plusReady(function(){
				var sendVCodeBtn = document.getElementById('send-verification-code');
				var canClick = true;
				sendVCodeBtn.addEventListener('tap', function(event) {
					if(!canClick) return;
					console.log("click sendVCodeBtn");
					canClick = false;
					var waiting = plus.nativeUI.showWaiting();
					var params = {};
					params[Api.Params.email] = document.getElementById('email').value;
					Repository.User.checkEmail(params, {
						ok: function(data) {
							waiting.close();
							mui.toast(TextMessage.send_code_ok, {
								duration: 'long',
								type: 'div'
							})
							var i = 0;
							var updateText = setInterval(function() {
								i++;
								sendVCodeBtn.innerText = TextMessage.send_verification_code + "(" + (180 - i) + "s)";
								if(180 - i == 0) {
									canClick = true;
									clearInterval(updateText);
								}
							}, 1000);
						},
						ng: function(data) {
							waiting.close();
							canClick = true;
							switch(data) {
								case "2013":
									mui.toast(TextMessage.email_error, {
										duration: 'long',
										type: 'div'
									})
									break;
								default:
							mui.toast(TextMessage.send_code_ng, {
								duration: 'long',
								type: 'div'
							})
									break;
							}
						},
						error: function() {
							canClick = true;
							waiting.close();
						}
					});
				});
			});
		</script>
	</body>

</html>